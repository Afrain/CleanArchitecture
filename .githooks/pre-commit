#!/bin/sh
# Format code before commit and re-stage changes

# Get staged files (only C#)
STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.cs$')

if [ -n "$STAGED_FILES" ]; then
  dotnet format
  STATUS=$?

  if [ $STATUS -ne 0 ]; then
    echo "dotnet format failed. Fix the issues and try again."
    exit 1
  fi

  # Re-add staged files so formatting is included in the commit
  echo "$STAGED_FILES" | xargs git add
fi

exit 0
